@using Resources
@model Ilaro.Admin.ViewModels.CreateViewModel

@{
	if (ViewBag.IsAjaxRequest)
	{
		Layout = null;
	}
	else
	{
		Layout = "~/Views/IlaroAdmin/_Layout.cshtml";
	}
	ViewBag.Title = string.Format(IlaroAdminResources.Create_Title, Model.Entity.Name);
}

@section Breadcrumb
{
	<ul class="breadcrumb">
		<li>@Html.ActionLink(IlaroAdminResources.Index_Title, "Index")</li>
		<li>@Html.ActionLink(Model.Entity.GroupName, "Group", new { groupName = Model.Entity.GroupName })</li>
		<li>@Html.ActionLink(Model.Entity.Plural, "List", new { entityName = Model.Entity.Name })</li>
		<li class="active">@string.Format(IlaroAdminResources.Create_Title, Model.Entity.Name)</li>
	</ul>
}

<h2>@Model.Entity.Singular</h2>

@using (Html.BeginForm("Create", "IlaroAdmin", FormMethod.Post, new { enctype = "multipart/form-data", @class = "form-horizontal", role = "form" }))
{
	@Html.AntiForgeryToken()
	@Html.ValidationSummary(true)

	if (Model.PropertiesGroups.Count > 1)
	{
		foreach (var group in Model.PropertiesGroups)
		{
			<fieldset>
				<legend>@group.GroupName <button type="button" class="btn pull-right"><i class="@Html.Condition(group.IsCollapsed, () => "glyphicon glyphicon-plus", () => "glyphicon glyphicon-minus")"></i></button></legend>
				<div class="fields @Html.Condition(group.IsCollapsed, () => "hide")">
					@foreach (var property in group.Properties)
					{
						<div class="form-group">
							@Html.EditorFor(m => property, property.EditorTemplateName)
							@if (property.IsForeignKey)
							{
								<a href="@Url.Action("Create", new { entityName = property.ForeignEntity.Name })" target="_blank" class="btn btn-primary create-foreign"><span class="glyphicon glyphicon-plus"></span></a>
							}
						</div>
					}
				</div>
			</fieldset>
		}
	}
	else if (Model.PropertiesGroups.Count == 1)
	{
		foreach (var property in Model.PropertiesGroups[0].Properties)
		{
			<div class="form-group">
				@Html.EditorFor(m => property, property.EditorTemplateName)
				@if (property.IsForeignKey)
				{
					<a href="@Url.Action("Create", new { entityName = property.ForeignEntity.Name })" target="_blank" class="btn btn-primary create-foreign"><span class="glyphicon glyphicon-plus"></span></a>
				}
			</div>
		}
	}

	@Html.Hidden("EntityName", Model.Entity.Name)

	<div class="form-action">
		<div class="col-md-offset-2">
			<button type="submit" class="btn btn-primary">@IlaroAdminResources.Save</button>
			<button type="submit" class="btn btn-default" name="ContinueEdit"><i class="glyphicon glyphicon-edit"></i> @IlaroAdminResources.SaveAndContinueEdit</button>
			<button type="submit" class="btn btn-default" name="AddNext"><i class="glyphicon glyphicon-plus"></i> @IlaroAdminResources.SaveAndAddNext</button>
			<a href="@Url.Action("List", new { entityName = Model.Entity.Name })" class="btn btn-link">@IlaroAdminResources.Cancel</a>
		</div>
	</div>
}

<div class="modal fade" id="foreign-modal" tabindex="-1" role="dialog" aria-labelledby="Create foreign entity" aria-hidden="true">
	<div class="modal-dialog" style="width:90%">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="myModalLabel">Create foreign entity</h4>
			</div>
			<div class="modal-body">
			</div>
		</div>
	</div>
</div>
